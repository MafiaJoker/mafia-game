import{a5 as pe,r as H,D as R,_ as j,a6 as be,n as N,b as d,s as g,t as F,d as t,w as a,a7 as Ye,i as X,x as k,a8 as qe,a9 as Xe,aa as Je,ab as he,c as V,L as M,j as h,F as K,ac as Re,l as U,ad as Ze,ae as Qe,af as et,ag as Ne,ah as tt,ai as at,aj as Ce,ak as Te,al as st,T as ve,v as ee,am as Se,an as nt,B as se,p as lt,q as Z,u as ce,ao as te,ap as ie,aq as $e,ar as ot,as as it,a4 as ke,at as de,au as rt,h as Ae,g as we,y as ut,av as ct,O as ae,aw as dt,ax as Pe,ay as Oe,H as mt,I as _t,e as Ie,J as Ee,a as ye,m as ft,E as gt,az as vt,aA as St,o as yt,W as pt,X as ht,Z as It,a3 as Et}from"./index-DopsCuGS.js";import{a as ue}from"./el-radio-DW38t20Y.js";/* empty css                  */const b={CIVILIAN:"Мирный",SHERIFF:"Шериф",MAFIA:"Мафия",DON:"Дон"},W={BEFORE_SILENCE:3,BEFORE_ELIMINATION:4},T={CREATED:"created",SEATING_READY:"seating_ready",ROLE_DISTRIBUTION:"role_distribution",IN_PROGRESS:"in_progress",FINISHED_NO_SCORES:"finished_no_scores",FINISHED_WITH_SCORES:"finished_with_scores",CANCELLED:"cancelled"},O={DISCUSSION:"discussion",CRITICAL_DISCUSSION:"critical_discussion",VOTING:"voting",SUSPECTS_SPEECH:"suspects_speech",FAREWELL_MINUTE:"farewell_minute",NIGHT:"night"},bt={[T.CREATED]:"Создана",[T.SEATING_READY]:"Рассадка готова",[T.ROLE_DISTRIBUTION]:"Роздача ролей",[T.IN_PROGRESS]:"В процессе",[T.FINISHED_NO_SCORES]:"Завершена без баллов",[T.FINISHED_WITH_SCORES]:"Завершена с баллами",[T.CANCELLED]:"Отменена"},Rt={[O.DISCUSSION]:"Обсуждение",[O.CRITICAL_DISCUSSION]:"Критический круг",[O.VOTING]:"Голосование",[O.SUSPECTS_SPEECH]:"Речь подозреваемых",[O.FAREWELL_MINUTE]:"Прощальная минута",[O.NIGHT]:"Ночь"},J=pe("game",()=>{const s=H(null),e=H({round:0,gameStatus:T.CREATED,gameSubstatus:null,isGameStarted:!1,players:[],nominatedPlayers:[],votingResults:{},shootoutPlayers:[],deadPlayers:[],eliminatedPlayers:[],nightKill:null,bestMoveUsed:!1,noCandidatesRounds:0,mafiaTarget:null,donTarget:null,sheriffTarget:null,bestMoveTargets:new Set,rolesVisible:!1,scores:{},isCriticalRound:!1,showBestMove:!1}),u=R(()=>c=>e.value.players.find(r=>r.id===c)),S=R(()=>e.value.players.filter(c=>c.isAlive&&!c.isEliminated)),o=R(()=>e.value.gameStatus===T.ROLE_DISTRIBUTION),y=R(()=>e.value.gameStatus===T.IN_PROGRESS),C=R(()=>{const c=e.value.players.filter(z=>z.role===b.MAFIA).length,r=e.value.players.filter(z=>z.role===b.DON).length,$=e.value.players.filter(z=>z.role===b.SHERIFF).length;return c===2&&r===1&&$===1}),w=async c=>{try{return l(T.FINISHED_NO_SCORES),e.value.isGameStarted=!1,p(c),s.value&&await ue.updateGame(s.value.gameId,{status:"finished",result:c,currentRound:e.value.round}),await E(),!0}catch(r){return console.error("Ошибка завершения игры:",r),!1}},p=c=>{e.value.players.forEach(r=>{let $=0;const z=c==="city_win"&&(r.originalRole===b.CIVILIAN||r.originalRole===b.SHERIFF)||c==="mafia_win"&&(r.originalRole===b.MAFIA||r.originalRole===b.DON);c==="draw"?$=.5:z?$=1:$=0,e.value.scores[r.id]=$})},i=(c,r,$=0)=>{e.value.scores[c]||(e.value.scores[c]={baseScore:0,additionalScore:0}),e.value.scores[c].baseScore=r,e.value.scores[c].additionalScore=$},n=c=>e.value.scores[c]||{baseScore:0,additionalScore:0},v=()=>e.value.deadPlayers.length===1&&e.value.eliminatedPlayers.length===0&&e.value.round===1&&!e.value.bestMoveUsed?(e.value.showBestMove=!0,!0):!1,A=async(c,r,$)=>{try{s.value={eventId:c,tableId:r,gameId:$},$?await I($):(m(),l(T.SEATING_READY))}catch(z){throw console.error("Ошибка инициализации игры:",z),z}},I=async c=>{try{const r=await ue.getGameState(c);return r?(Object.assign(e.value,r),r.bestMoveTargets&&Array.isArray(r.bestMoveTargets)&&(e.value.bestMoveTargets=new Set(r.bestMoveTargets)),!0):!1}catch(r){return console.error("Ошибка загрузки состояния игры:",r),!1}},E=async()=>{var c;if(!((c=s.value)!=null&&c.gameId))return!1;try{const r={...e.value,bestMoveTargets:Array.from(e.value.bestMoveTargets)};return await ue.saveGameState(s.value.gameId,r),!0}catch(r){return console.error("Ошибка сохранения состояния игры:",r),!1}},m=()=>{e.value.players=[];for(let c=1;c<=10;c++)e.value.players.push({id:c,name:`Игрок ${c}`,role:b.CIVILIAN,originalRole:b.CIVILIAN,fouls:0,nominated:null,isAlive:!0,isEliminated:!1,isSilent:!1,silentNextRound:!1}),e.value.scores[c]={baseScore:0,additionalScore:0}},l=(c,r=null)=>{e.value.gameStatus=c,e.value.gameSubstatus=r},D=c=>{if(!o.value)return;const r=u.value(c);if(!r)return;const $=e.value.players.map(le=>le.role),z=G(r.role,$);return r.role=z,r.originalRole=z,z},G=(c,r)=>{const $=r.filter(oe=>oe===b.MAFIA).length,z=r.filter(oe=>oe===b.DON).length,le=r.filter(oe=>oe===b.SHERIFF).length;if(c===b.CIVILIAN){if($<2)return b.MAFIA;if(z<1)return b.DON;if(le<1)return b.SHERIFF}else{if(c===b.MAFIA)return z<1?b.DON:le<1?b.SHERIFF:b.CIVILIAN;if(c===b.DON)return le<1?b.SHERIFF:b.CIVILIAN;if(c===b.SHERIFF)return b.CIVILIAN}return c},B=(c,r)=>{const $=u.value(c);$&&($.nominated=r||null,P())},P=()=>{const c=e.value.players.filter(r=>r.isAlive&&!r.isEliminated&&r.nominated!==null).map(r=>r.nominated);e.value.nominatedPlayers=[...new Set(c)].filter(r=>{const $=u.value(r);return $&&$.isAlive&&!$.isEliminated})},f=c=>{const r=u.value(c);r&&r.fouls++},_=c=>{const r=u.value(c);r&&(r.isEliminated=!0,r.isAlive=!1,e.value.eliminatedPlayers.push(c),e.value.players.forEach($=>{$.nominated===c&&($.nominated=null)}))},Y=(c,r)=>{const $=u.value(c);$&&($.role=r,$.originalRole=r)},x=c=>{s.value={eventId:c.eventId,tableId:c.tableId,gameId:c.gameId||null},e.value={round:0,gameStatus:T.CREATED,gameSubstatus:null,isGameStarted:!1,players:[],nominatedPlayers:[],votingResults:{},shootoutPlayers:[],deadPlayers:[],eliminatedPlayers:[],nightKill:null,bestMoveUsed:!1,noCandidatesRounds:0,mafiaTarget:null,donTarget:null,sheriffTarget:null,bestMoveTargets:new Set,rolesVisible:!1,scores:{},isCriticalRound:!1,showBestMove:!1,firstEliminatedPlayer:null}},q=c=>{const r={id:c.id,name:c.nickname||c.name,nickname:c.nickname,realName:c.realName,role:b.CIVILIAN,originalRole:b.CIVILIAN,fouls:0,canSpeak:!0,nominated:null,isAlive:!0,isEliminated:!1,isSilent:!1,silentNextRound:!1,seatNumber:e.value.players.length+1,status:"ALIVE"};e.value.players.push(r),e.value.scores[r.id]=0},re=()=>{const c=[...Array(6).fill(b.CIVILIAN),...Array(2).fill(b.MAFIA),b.DON,b.SHERIFF];for(let r=c.length-1;r>0;r--){const $=Math.floor(Math.random()*(r+1));[c[r],c[$]]=[c[$],c[r]]}e.value.players.forEach((r,$)=>{r.role=c[$],r.originalRole=c[$]})},me=async()=>{var c,r;if(e.value.gameStatus=T.IN_PROGRESS,e.value.gameSubstatus=O.DISCUSSION,e.value.isGameStarted=!0,e.value.round=1,e.value.phase="DAY",!((c=s.value)!=null&&c.gameId)&&s.value)try{const $=await ue.createGame({eventId:s.value.eventId});(r=$==null?void 0:$.data)!=null&&r.id&&(s.value.gameId=$.data.id)}catch($){console.error("Failed to create game:",$)}await E()},_e=()=>{e.value.round++,e.value.gameSubstatus=O.DISCUSSION},fe=()=>{e.value.noCandidatesRounds++},ne=c=>{const r=u.value(c);r&&r.isAlive&&(r.isAlive=!1,r.status="VOTED_OUT",e.value.deadPlayers.push(c),e.value.deadPlayers.length===1&&e.value.round===1&&(e.value.showBestMove=!0,e.value.firstEliminatedPlayer=c),e.value.noCandidatesRounds=0)},ge=c=>{const r=u.value(c);r&&(r.fouls++,r.fouls>=3&&(r.canSpeak=!1),r.fouls>=4&&(r.isEliminated=!0,r.isAlive=!1,r.status="KICKED",e.value.eliminatedPlayers.includes(c)||e.value.eliminatedPlayers.push(c)))},L=c=>{const r=u.value(c);r&&r.fouls>0&&r.fouls--},Q=c=>{e.value.nightKill=c},De=()=>{if(e.value.nightKill){const c=u.value(e.value.nightKill);c&&c.isAlive&&(c.isAlive=!1,c.status="KILLED",e.value.deadPlayers.push(e.value.nightKill)),e.value.nightKill=null}},Fe=c=>{const r=Array.from(e.value.bestMoveTargets),$=r.indexOf(c);$!==-1?r.splice($,1):r.length<3&&r.push(c),e.value.bestMoveTargets=new Set(r)},Ge=()=>{e.value.bestMoveUsed=!0,e.value.showBestMove=!1},Le=()=>{e.value.phase==="DAY"?(e.value.phase="NIGHT",e.value.gameSubstatus=O.MAFIA_KILL):(e.value.phase="DAY",e.value.gameSubstatus=O.DISCUSSION)},Be=R(()=>e.value.players),xe=R(()=>e.value.phase),Ue=R(()=>e.value.round),He=R(()=>({noCandidatesRounds:e.value.noCandidatesRounds,bestMoveUsed:e.value.bestMoveUsed})),ze=R(()=>e.value.showBestMove),Ke=R(()=>e.value.firstEliminatedPlayer),We=R(()=>Array.from(e.value.bestMoveTargets)),je=R(()=>{const c=e.value.players.filter(r=>r.isAlive&&!r.isEliminated).length;return c===3||c===4});return{gameInfo:s,gameState:e,currentPlayer:u,alivePlayers:S,isInRoleDistribution:o,isGameInProgress:y,canStartGame:C,checkBestMove:v,finishGame:w,setBaseScores:p,setPlayerScore:i,getPlayerScore:n,initGame:A,loadGameState:I,saveGameState:E,initPlayers:m,setGameStatus:l,changePlayerRole:D,nominatePlayer:B,updateNominatedPlayers:P,incrementFoul:f,eliminatePlayer:_,assignRole:Y,distributeRolesRandomly:re,startGame:me,nextRound:_e,incrementNoCandidatesRounds:fe,eliminatePlayerByVote:ne,addFoul:ge,removeFoul:L,setNightKill:Q,applyNightKill:De,toggleBestMoveTarget:Fe,useBestMove:Ge,initializeGame:x,addPlayer:q,nextPhase:Le,players:Be,phase:xe,round:Ue,game:He,showBestMove:ze,firstEliminatedPlayer:Ke,bestMoveTargets:We,isCriticalRound:je}}),Nt={class:"game-timer"},Ct={class:"timer-display"},Tt={class:"time-text"},$t={class:"timer-controls"},kt={__name:"GameTimer",setup(s){const e=H(0),u=H(!1);let S=null;const o=R(()=>{const p=Math.floor(e.value/60),i=e.value%60;return`${p.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}),y=()=>{u.value||(u.value=!0,S=setInterval(()=>{e.value++},1e3))},C=()=>{u.value&&(u.value=!1,S&&(clearInterval(S),S=null))},w=()=>{C(),e.value=0};return be(()=>{S&&clearInterval(S)}),(p,i)=>{const n=X,v=Ye,A=he;return d(),N("div",Nt,[g("div",Ct,[g("span",Tt,F(o.value),1)]),g("div",$t,[t(A,null,{default:a(()=>[t(v,{content:"Старт"},{default:a(()=>[t(n,{icon:k(qe),type:u.value?"success":"primary",size:"small",onClick:y,disabled:u.value},null,8,["icon","type","disabled"])]),_:1}),t(v,{content:"Пауза"},{default:a(()=>[t(n,{icon:k(Xe),type:"warning",size:"small",onClick:C,disabled:!u.value},null,8,["icon","disabled"])]),_:1}),t(v,{content:"Сброс"},{default:a(()=>[t(n,{icon:k(Je),type:"info",size:"small",onClick:w},null,8,["icon"])]),_:1})]),_:1})])])}}},At=j(kt,[["__scopeId","data-v-25489929"]]),Ve=pe("voting",()=>{const s=J();return{startVoting:()=>s.gameState.nominatedPlayers.length===0?!1:(s.setGameStatus(s.gameState.gameStatus,O.VOTING),s.gameState.votingResults={},!0),registerVotes:(i,n)=>{n===0?delete s.gameState.votingResults[i]:s.gameState.votingResults[i]=n},confirmVoting:()=>{const i=s.gameState.votingResults;if(Object.keys(i).length===0)return null;let n=0,v=[];if(Object.entries(i).forEach(([A,I])=>{I>n?(n=I,v=[parseInt(A)]):I===n&&v.push(parseInt(A))}),v.length>1){if(!(v.length===s.gameState.shootoutPlayers.length&&v.every(E=>s.gameState.shootoutPlayers.includes(E))))return s.gameState.shootoutPlayers=v,s.gameState.votingResults={},s.gameState.nominatedPlayers=v,{result:"shootout",players:v};const I=s.alivePlayers.length;return v.length>=I/2?(s.gameState.noCandidatesRounds++,{result:"tooMany",count:v.length,totalAlive:I}):{result:"multipleElimination",players:v}}if(v.length===1){const A=v[0];s.eliminatePlayerByVote(A),s.gameState.noCandidatesRounds=0}return s.gameState.shootoutPlayers=[],s.gameState.nominatedPlayers=[],s.gameState.votingResults={},{result:"eliminated",players:v}},resetVoting:()=>{s.gameState.votingResults={},s.gameState.votes=[]},addVote:({voterId:i,candidateId:n})=>{s.gameState.votes||(s.gameState.votes=[]),s.gameState.votes.push({voterId:i,candidateId:n})},getVotingResult:()=>{if(!s.gameState.votes||s.gameState.votes.length===0)return{eliminated:[]};const i={};s.gameState.votes.forEach(I=>{i[I.candidateId]||(i[I.candidateId]=0),i[I.candidateId]++});let n=0,v=[];Object.entries(i).forEach(([I,E])=>{E>n?(n=E,v=[parseInt(I)]):E===n&&v.push(parseInt(I))});const A=s.players.filter(I=>I.status==="ALIVE").length;return v.length>=A/2?{eliminated:[]}:{eliminated:v}},handleShootout:i=>{s.gameState.shootoutPlayers=i},setShootoutLoser:i=>{const n=s.players.find(v=>v.id===i);n&&(n.shootoutLoser=!0)}}}),Me=pe("nightActions",()=>{const s=J(),e=H(null),u=H(null);return H(null),{checkSheriff:i=>{const n=s.currentPlayer(i);if(!n)return null;const v=n.originalRole===b.MAFIA||n.originalRole===b.DON;return{targetId:i,targetName:n.name,isMafia:v}},checkDon:i=>{const n=s.currentPlayer(i);if(!n)return null;const v=n.originalRole===b.SHERIFF;return{targetId:i,targetName:n.name,isSheriff:v}},confirmNight:()=>{if(s.gameState.mafiaTarget&&s.gameState.mafiaTarget!==0){const i=s.currentPlayer(s.gameState.mafiaTarget);i&&i.isAlive&&!i.isEliminated&&(i.isAlive=!1,s.gameState.deadPlayers.push(s.gameState.mafiaTarget),s.gameState.nightKill=s.gameState.mafiaTarget,s.gameState.players.forEach(n=>{n.nominated===s.gameState.mafiaTarget&&(n.nominated=null)}))}return s.gameState.round++,s.checkBestMove()?{round:s.gameState.round,killed:s.gameState.nightKill}:(s.setGameStatus(s.gameState.gameStatus,O.DISCUSSION),s.gameState.players.forEach(i=>{i.silentNextRound?(i.isSilent=!0,i.silentNextRound=!1):i.isSilent&&(i.isSilent=!1)}),s.gameState.deadPlayers.length===1&&s.gameState.eliminatedPlayers.length===0&&s.gameState.round===1&&!s.gameState.bestMoveUsed&&(s.gameState.showBestMove=!0),{round:s.gameState.round,killed:s.gameState.nightKill})},setNightKill:i=>{e.value=i,s.setNightKill(i)},setSheriffCheck:i=>{u.value=i},getSheriffCheckResult:i=>{if(!u.value)return null;const n=i.find(v=>v.id===u.value);return n?{targetId:u.value,role:n.role}:null}}}),wt={class:"game-controls"},Pt={__name:"GameControls",setup(s){const e=J(),u=Ve(),S=Me(),o=R(()=>e.gameState),y=R(()=>o.value.nominatedPlayers.length),C=R(()=>o.value.showBestMove),w=R(()=>o.value.bestMoveTargets.size),p=()=>{e.setGameStatus(T.ROLE_DISTRIBUTION),U.info("Распределите роли между игроками")},i=()=>{o.value.players.forEach(P=>{P.role="Мирный",P.originalRole="Мирный"}),e.setGameStatus(T.SEATING_READY),U.info("Раздача ролей отменена")},n=async()=>{if(!e.canStartGame){U.error("Необходимо распределить 2 мафии, 1 дона и 1 шерифа!");return}e.setGameStatus(T.IN_PROGRESS,O.DISCUSSION),o.value.isGameStarted=!0,o.value.round=1,await e.saveGameState(),U.success("Игра началась!")},v=()=>{if(y.value===1&&o.value.round>0){const P=o.value.nominatedPlayers[0],f=e.currentPlayer(P);U.warning(`Игрок ${f.name} автоматически выбывает как единственная кандидатура`),e.eliminatePlayer(P),o.value.nominatedPlayers=[],o.value.players.forEach(_=>{_.nominated=null});return}u.startVoting()},A=()=>{u.confirmVoting()},I=()=>{u.resetVoting()},E=()=>{e.setGameStatus(e.gameState.gameStatus,e.isCriticalRound?O.CRITICAL_DISCUSSION:O.DISCUSSION),o.value.votingResults={},o.value.shootoutPlayers=[]},m=()=>{e.setGameStatus(e.gameState.gameStatus,O.NIGHT),o.value.mafiaTarget=null,o.value.donTarget=null,o.value.sheriffTarget=null,o.value.nominatedPlayers=[],o.value.players.forEach(P=>{P.nominated=null})},l=()=>{S.confirmNight()},D=()=>{e.setGameStatus(e.gameState.gameStatus,O.FAREWELL_MINUTE)},G=()=>{o.value.bestMoveUsed=!0,o.value.showBestMove=!1,U.success("Лучший ход подтвержден")},B=()=>{};return(P,f)=>{const _=X,Y=Re;return d(),N("div",wt,[o.value.gameStatus===k(T).SEATING_READY?(d(),V(_,{key:0,type:"primary",onClick:p},{default:a(()=>f[0]||(f[0]=[h(" Начать раздачу ролей ")])),_:1,__:[0]})):M("",!0),o.value.gameStatus===k(T).ROLE_DISTRIBUTION?(d(),N(K,{key:1},[t(_,{type:"warning",onClick:i},{default:a(()=>f[1]||(f[1]=[h(" Отменить раздачу ")])),_:1,__:[1]}),t(_,{type:"success",onClick:n,disabled:!k(e).canStartGame},{default:a(()=>f[2]||(f[2]=[h(" Начать игру ")])),_:1,__:[2]},8,["disabled"])],64)):M("",!0),o.value.gameStatus===k(T).IN_PROGRESS?(d(),N(K,{key:2},[o.value.gameSubstatus===k(O).DISCUSSION||o.value.gameSubstatus===k(O).CRITICAL_DISCUSSION?(d(),N(K,{key:0},[t(_,{type:"warning",onClick:v,disabled:y.value===0},{default:a(()=>f[3]||(f[3]=[h(" Начать голосование ")])),_:1,__:[3]},8,["disabled"]),y.value===0?(d(),V(_,{key:0,type:"info",onClick:m},{default:a(()=>f[4]||(f[4]=[h(" В ночь ")])),_:1,__:[4]})):M("",!0)],64)):M("",!0),o.value.gameSubstatus===k(O).VOTING?(d(),N(K,{key:1},[t(_,{type:"success",onClick:A},{default:a(()=>f[5]||(f[5]=[h(" Подтвердить голосование ")])),_:1,__:[5]}),t(_,{type:"danger",onClick:I},{default:a(()=>f[6]||(f[6]=[h(" Начать заново ")])),_:1,__:[6]}),t(_,{type:"info",onClick:E},{default:a(()=>f[7]||(f[7]=[h(" Отменить голосование ")])),_:1,__:[7]})],64)):M("",!0),o.value.gameSubstatus===k(O).NIGHT?(d(),V(_,{key:2,type:"success",onClick:l},{default:a(()=>f[8]||(f[8]=[h(" Подтвердить итоги ночи ")])),_:1,__:[8]})):M("",!0),o.value.gameSubstatus===k(O).SUSPECTS_SPEECH?(d(),V(_,{key:3,type:"primary",onClick:D},{default:a(()=>f[9]||(f[9]=[h(" К прощальной минуте ")])),_:1,__:[9]})):M("",!0),o.value.gameSubstatus===k(O).FAREWELL_MINUTE?(d(),V(_,{key:4,type:"info",onClick:m},{default:a(()=>f[10]||(f[10]=[h(" В ночь ")])),_:1,__:[10]})):M("",!0)],64)):M("",!0),o.value.gameStatus===k(T).FINISHED_NO_SCORES?(d(),V(_,{key:3,type:"success",onClick:B},{default:a(()=>f[11]||(f[11]=[h(" Выставить баллы ")])),_:1,__:[11]})):M("",!0),C.value?(d(),V(Y,{key:4,value:w.value,max:3},{default:a(()=>[t(_,{type:"warning",onClick:G,disabled:w.value!==3},{default:a(()=>f[12]||(f[12]=[h(" Подтвердить ЛХ ")])),_:1,__:[12]},8,["disabled"])]),_:1},8,["value"])):M("",!0)])}}},Ot=j(Pt,[["__scopeId","data-v-03378d88"]]),Vt={class:"status-content"},Mt={class:"status-icon"},Dt={class:"status-text"},Ft={class:"status-title"},Gt={key:0,class:"status-description"},Lt={key:0,class:"status-progress"},Bt={__name:"GameStatusCard",setup(s){Ze(n=>({"2cfb26d6":C.value}));const e=J(),u=R(()=>e.gameState.gameStatus!==T.CREATED),S=R(()=>{const n=bt[e.gameState.gameStatus]||"Неизвестно",v=e.gameState.gameSubstatus?Rt[e.gameState.gameSubstatus]:null;return v?`${n} - ${v}`:n}),o=R(()=>{const n=e.gameState.gameStatus,v=e.gameState.gameSubstatus;switch(n){case T.SEATING_READY:return"Рассадка готова. Можно приступать к раздаче ролей.";case T.ROLE_DISTRIBUTION:return"Распределите роли между игроками: 2 мафии, 1 дон, 1 шериф.";case T.IN_PROGRESS:switch(v){case O.DISCUSSION:return"Идет обсуждение. Игроки выдвигают кандидатуры.";case O.CRITICAL_DISCUSSION:return"Критический круг! Угадайка - последний шанс города.";case O.VOTING:return"Голосование по выставленным кандидатурам.";case O.NIGHT:return"Ночь. Мафия стреляет, дон и шериф проверяют.";case O.SUSPECTS_SPEECH:return"Речь подозреваемых на попиле.";case O.FAREWELL_MINUTE:return"Прощальная минута заголосованного игрока.";default:return"Игра в процессе."}case T.FINISHED_NO_SCORES:return"Игра завершена. Выставите баллы игрокам.";case T.FINISHED_WITH_SCORES:return"Игра завершена с выставленными баллами.";case T.CANCELLED:return"Игра была отменена.";default:return null}}),y=R(()=>{const n=e.gameState.gameStatus,v=e.gameState.gameSubstatus;switch(n){case T.SEATING_READY:return ve;case T.ROLE_DISTRIBUTION:return st;case T.IN_PROGRESS:switch(v){case O.VOTING:return Te;case O.NIGHT:return Ce;case O.CRITICAL_DISCUSSION:return at;default:return tt}case T.FINISHED_NO_SCORES:case T.FINISHED_WITH_SCORES:return Ne;case T.CANCELLED:return et;default:return Qe}}),C=R(()=>{const n=e.gameState.gameStatus,v=e.gameState.gameSubstatus;switch(n){case T.SEATING_READY:return"#409eff";case T.ROLE_DISTRIBUTION:return"#e6a23c";case T.IN_PROGRESS:switch(v){case O.CRITICAL_DISCUSSION:return"#f56c6c";case O.NIGHT:return"#909399";default:return"#67c23a"}case T.FINISHED_NO_SCORES:case T.FINISHED_WITH_SCORES:return"#67c23a";case T.CANCELLED:return"#f56c6c";default:return"#909399"}}),w=R(()=>e.gameState.gameStatus===T.IN_PROGRESS),p=R(()=>{if(!w.value)return 0;const n=e.gameState.round;return Math.min(n/10*100,100)}),i=R(()=>{const n=p.value;return n<30?"success":n<70?"warning":"exception"});return(n,v)=>{const A=ee,I=nt,E=se;return u.value?(d(),V(E,{key:0,class:"game-status-card mb-4"},{default:a(()=>[g("div",Vt,[g("div",Mt,[t(A,{size:24,color:C.value},{default:a(()=>[(d(),V(Se(y.value)))]),_:1},8,["color"])]),g("div",Dt,[g("h4",Ft,F(S.value),1),o.value?(d(),N("p",Gt,F(o.value),1)):M("",!0)]),w.value?(d(),N("div",Lt,[t(I,{percentage:p.value,status:i.value,"stroke-width":8},null,8,["percentage","status"])])):M("",!0)])]),_:1})):M("",!0)}}},xt=j(Bt,[["__scopeId","data-v-f3259450"]]),Ut={class:"card-header"},Ht={class:"voting-content"},zt={class:"candidates-section mb-4"},Kt={key:0,class:"no-candidates"},Wt={key:1,class:"candidates-grid"},jt={class:"candidate-info"},Yt={class:"candidate-number"},qt={class:"candidate-name"},Xt={class:"voting-buttons"},Jt={key:0,class:"results-section"},Zt={class:"results-grid"},Qt={class:"result-player"},ea={class:"votes-summary"},ta={key:1,class:"shootout-message"},aa={__name:"VotingSection",setup(s){const e=J(),u=Ve(),S=R(()=>e.gameState.nominatedPlayers),o=R(()=>Object.entries(e.gameState.votingResults).filter(([m,l])=>l>0)),y=R(()=>o.value.length>0),C=R(()=>e.gameState.players.filter(m=>m.isAlive&&!m.isEliminated).length),w=R(()=>Object.values(e.gameState.votingResults).reduce((m,l)=>m+l,0)),p=R(()=>C.value-w.value),i=R(()=>e.gameState.shootoutPlayers.length>0?`Перестрелка между игроками: ${e.gameState.shootoutPlayers.map(l=>`${l}: ${n(l)}`).join(", ")}`:null),n=m=>{const l=e.currentPlayer(m);return l?l.name:`Игрок ${m}`},v=(m,l)=>e.gameState.votingResults[m]===l?"primary":"info",A=m=>{const l=e.gameState.votingResults[m]||0,D=p.value+l,G=[];for(let B=1;B<=D;B++)G.push(B);return G},I=m=>{const l=Math.abs(m)%100;if(l>=5&&l<=20)return"голосов";const D=l%10;return D===1?"голос":D>=2&&D<=4?"голоса":"голосов"},E=(m,l)=>{u.registerVotes(m,l)};return(m,l)=>{const D=ee,G=lt,B=X,P=he,f=ce,_=te,Y=se;return d(),V(Y,{class:"voting-section mb-4"},{header:a(()=>[g("div",Ut,[t(D,null,{default:a(()=>[t(k(Te))]),_:1}),l[0]||(l[0]=g("span",null,"Голосование",-1))])]),default:a(()=>[g("div",Ht,[g("div",zt,[l[2]||(l[2]=g("h5",{class:"section-title"},"Кандидаты на голосование:",-1)),S.value.length===0?(d(),N("div",Kt,[t(G,{description:"Нет кандидатур для голосования"})])):(d(),N("div",Wt,[(d(!0),N(K,null,Z(S.value,x=>(d(),N("div",{key:x,class:"candidate-card"},[g("div",jt,[g("span",Yt,F(x),1),g("span",qt,F(n(x)),1)]),g("div",Xt,[t(P,null,{default:a(()=>[t(B,{type:v(x,0),size:"small",onClick:q=>E(x,0)},{default:a(()=>l[1]||(l[1]=[h(" 0 ")])),_:2,__:[1]},1032,["type","onClick"]),(d(!0),N(K,null,Z(A(x),q=>(d(),V(B,{key:q,type:v(x,q),size:"small",onClick:re=>E(x,q)},{default:a(()=>[h(F(q),1)]),_:2},1032,["type","onClick"]))),128))]),_:2},1024)])]))),128))]))]),y.value?(d(),N("div",Jt,[l[3]||(l[3]=g("h5",{class:"section-title"},"Результаты голосования:",-1)),g("div",Zt,[(d(!0),N(K,null,Z(o.value,([x,q])=>(d(),N("div",{key:x,class:"result-item"},[g("span",Qt,F(x)+": "+F(n(parseInt(x))),1),t(f,{type:"primary",size:"large"},{default:a(()=>[h(F(q)+" "+F(I(q)),1)]),_:2},1024)]))),128))]),g("div",ea,[t(f,{type:"info",effect:"plain"},{default:a(()=>[h(" Осталось голосов: "+F(p.value),1)]),_:1})])])):M("",!0),i.value?(d(),N("div",ta,[t(_,{title:i.value,type:"warning",closable:!1,"show-icon":""},null,8,["title"])])):M("",!0)])]),_:1})}}},sa=j(aa,[["__scopeId","data-v-7fafaf20"]]),na={class:"card-header"},la={class:"night-content"},oa={class:"action-group mb-6"},ia={class:"action-title"},ra={key:0,class:"no-players"},ua={key:1,class:"targets-grid"},ca={class:"action-group mb-6"},da={class:"action-title"},ma={key:0,class:"no-players"},_a={key:1},fa={class:"targets-grid mb-3"},ga={key:0,class:"check-result"},va={class:"action-group"},Sa={class:"action-title"},ya={key:0,class:"no-players"},pa={key:1},ha={class:"targets-grid mb-3"},Ia={key:0,class:"check-result"},Ea={__name:"NightActionsSection",setup(s){const e=J(),u=Me(),S=H(null),o=H(null),y=R(()=>e.gameState.players.filter(m=>m.isAlive&&!m.isEliminated)),C=R(()=>e.gameState.players.some(m=>(m.originalRole===b.MAFIA||m.originalRole===b.DON)&&m.isAlive&&!m.isEliminated)),w=R(()=>e.gameState.players.some(m=>m.originalRole===b.DON&&m.isAlive&&!m.isEliminated)),p=R(()=>e.gameState.players.some(m=>m.originalRole===b.SHERIFF&&m.isAlive&&!m.isEliminated)),i=m=>e.gameState.mafiaTarget===m?"danger":"info",n=m=>e.gameState.donTarget===m?"warning":"info",v=m=>e.gameState.sheriffTarget===m?"primary":"info",A=m=>{e.gameState.mafiaTarget=m},I=m=>{if(e.gameState.donTarget=m,m){const l=u.checkDon(m);l&&(S.value={message:l.isSheriff?`Игрок ${l.targetId}: ${l.targetName} является шерифом!`:`Игрок ${l.targetId}: ${l.targetName} не является шерифом.`,type:l.isSheriff?"success":"error"})}else S.value=null},E=m=>{if(e.gameState.sheriffTarget=m,m){const l=u.checkSheriff(m);l&&(o.value={message:l.isMafia?`Игрок ${l.targetId}: ${l.targetName} является членом мафии!`:`Игрок ${l.targetId}: ${l.targetName} является мирным жителем.`,type:l.isMafia?"error":"success"})}else o.value=null};return(m,l)=>{const D=ee,G=te,B=X,P=he,f=se;return d(),V(f,{class:"night-section mb-4"},{header:a(()=>[g("div",na,[t(D,null,{default:a(()=>[t(k(Ce))]),_:1}),l[1]||(l[1]=g("span",null,"Ночные действия",-1))])]),default:a(()=>[g("div",la,[g("div",oa,[g("h5",ia,[t(D,null,{default:a(()=>[t(k(ie))]),_:1}),l[2]||(l[2]=h(" Стрельба мафии: "))]),C.value?(d(),N("div",ua,[t(P,null,{default:a(()=>[(d(!0),N(K,null,Z(y.value,_=>(d(),V(B,{key:`mafia-${_.id}`,type:i(_.id),onClick:Y=>A(_.id)},{default:a(()=>[h(F(_.id),1)]),_:2},1032,["type","onClick"]))),128)),t(B,{type:i(0),onClick:l[0]||(l[0]=_=>A(0))},{default:a(()=>l[3]||(l[3]=[h(" Промах ")])),_:1,__:[3]},8,["type"])]),_:1})])):(d(),N("div",ra,[t(G,{title:"Нет живых игроков команды мафии",type:"info",closable:!1})]))]),g("div",ca,[g("h5",da,[t(D,null,{default:a(()=>[t(k(ie))]),_:1}),l[4]||(l[4]=h(" Проверка дона: "))]),w.value?(d(),N("div",_a,[g("div",fa,[t(P,null,{default:a(()=>[(d(!0),N(K,null,Z(y.value,_=>(d(),V(B,{key:`don-${_.id}`,type:n(_.id),onClick:Y=>I(_.id)},{default:a(()=>[h(F(_.id),1)]),_:2},1032,["type","onClick"]))),128))]),_:1})]),S.value?(d(),N("div",ga,[t(G,{title:S.value.message,type:S.value.type,closable:!1,"show-icon":""},null,8,["title","type"])])):M("",!0)])):(d(),N("div",ma,[t(G,{title:"Дон мертв или отсутствует",type:"info",closable:!1})]))]),g("div",va,[g("h5",Sa,[t(D,null,{default:a(()=>[t(k($e))]),_:1}),l[5]||(l[5]=h(" Проверка шерифа: "))]),p.value?(d(),N("div",pa,[g("div",ha,[t(P,null,{default:a(()=>[(d(!0),N(K,null,Z(y.value,_=>(d(),V(B,{key:`sheriff-${_.id}`,type:v(_.id),onClick:Y=>E(_.id)},{default:a(()=>[h(F(_.id),1)]),_:2},1032,["type","onClick"]))),128))]),_:1})]),o.value?(d(),N("div",Ia,[t(G,{title:o.value.message,type:o.value.type,closable:!1,"show-icon":""},null,8,["title","type"])])):M("",!0)])):(d(),N("div",ya,[t(G,{title:"Шериф мертв или отсутствует",type:"info",closable:!1})]))])])]),_:1})}}},ba=j(Ea,[["__scopeId","data-v-dbd10004"]]),Ra={class:"card-header"},Na={class:"selected-count"},Ca={class:"best-move-content"},Ta={class:"best-move-info mb-4"},$a={class:"players-selection"},ka={class:"players-grid"},Aa={class:"player-info"},wa={class:"player-number"},Pa={class:"player-name"},Oa={class:"best-move-actions mt-4"},Va={__name:"BestMoveSection",setup(s){const e=J(),u=R(()=>e.gameState.players.filter(i=>i.isAlive&&!i.isEliminated)),S=R(()=>e.gameState.bestMoveTargets.size),o=R(()=>{const i=e.gameState.deadPlayers[0];if(i){const n=e.currentPlayer(i);return`Лучший ход для игрока ${i}: ${(n==null?void 0:n.name)||"Неизвестно"}`}return"Лучший ход"}),y=i=>e.gameState.bestMoveTargets.has(i)?"success":"info",C=i=>e.gameState.bestMoveTargets.has(i)||e.gameState.bestMoveTargets.size<3,w=i=>{const n=e.gameState.bestMoveTargets;n.has(i)?n.delete(i):n.size<3&&n.add(i)},p=()=>{if(S.value!==3){U.error("Необходимо выбрать ровно 3 игроков");return}e.gameState.bestMoveUsed=!0,e.gameState.showBestMove=!1,e.gameState.bestMoveTargets.clear(),U.success("Лучший ход подтвержден")};return(i,n)=>{const v=ee,A=Re,I=te,E=X,m=se;return d(),V(m,{class:"best-move-section mb-4"},{header:a(()=>[g("div",Ra,[t(v,null,{default:a(()=>[t(k(it))]),_:1}),n[0]||(n[0]=g("span",null,"Лучший ход",-1)),t(A,{value:S.value,max:3,class:"ml-2"},{default:a(()=>[g("span",Na,"Выбрано: "+F(S.value)+"/3",1)]),_:1},8,["value"])])]),default:a(()=>[g("div",Ca,[g("div",Ta,[t(I,{title:o.value,type:"info",closable:!1,"show-icon":""},null,8,["title"])]),g("div",$a,[n[1]||(n[1]=g("h6",{class:"section-title"},"Выберите 3 игроков для лучшего хода:",-1)),g("div",ka,[(d(!0),N(K,null,Z(u.value,l=>(d(),V(E,{key:l.id,type:y(l.id),size:"large",onClick:D=>w(l.id),disabled:!C(l.id),class:"player-button"},{default:a(()=>[g("div",Aa,[g("div",wa,F(l.id),1),g("div",Pa,F(l.name),1)])]),_:2},1032,["type","onClick","disabled"]))),128))])]),g("div",Oa,[t(E,{type:"success",size:"large",onClick:p,disabled:S.value!==3,style:{width:"100%"}},{default:a(()=>[t(v,null,{default:a(()=>[t(k(ot))]),_:1}),n[2]||(n[2]=h(" Подтвердить лучший ход "))]),_:1,__:[2]},8,["disabled"])])])]),_:1})}}},Ma=j(Va,[["__scopeId","data-v-7cede7ac"]]),Da={class:"player-fouls"},Fa={class:"fouls-display"},Ga={key:0,class:"foul-actions mt-2"},La={__name:"PlayerFouls",props:{player:{type:Object,required:!0}},emits:["increment","reset","silentNow","silentNext","eliminate"],setup(s,{emit:e}){const u=s,S=e,o=R(()=>u.player.fouls>=W.BEFORE_SILENCE),y=()=>u.player.fouls>=W.BEFORE_ELIMINATION?"danger":u.player.fouls>=W.BEFORE_SILENCE?"warning":"primary",C=()=>{(u.player.fouls<W.BEFORE_SILENCE||u.player.fouls===W.BEFORE_SILENCE&&(u.player.isSilent||u.player.silentNextRound)||u.player.fouls>=W.BEFORE_ELIMINATION)&&S("increment",u.player.id)};return(w,p)=>{const i=X,n=de;return d(),N("div",Da,[g("div",Fa,[t(i,{type:y(),size:"small",round:"",onClick:C,class:ke({"fouls-maxed":s.player.fouls>=k(W).BEFORE_ELIMINATION})},{default:a(()=>[h(F(s.player.fouls),1)]),_:1},8,["type","class"])]),o.value?(d(),N("div",Ga,[t(n,{direction:"vertical",size:"small"},{default:a(()=>[s.player.fouls===k(W).BEFORE_SILENCE&&!s.player.isSilent&&!s.player.silentNextRound?(d(),V(i,{key:0,type:"warning",size:"small",onClick:p[0]||(p[0]=v=>S("silentNow",s.player.id))},{default:a(()=>p[4]||(p[4]=[h(" Молчит сейчас ")])),_:1,__:[4]})):M("",!0),s.player.fouls===k(W).BEFORE_SILENCE&&!s.player.isSilent&&!s.player.silentNextRound?(d(),V(i,{key:1,type:"info",size:"small",onClick:p[1]||(p[1]=v=>S("silentNext",s.player.id))},{default:a(()=>p[5]||(p[5]=[h(" Молчит след. круг ")])),_:1,__:[5]})):M("",!0),s.player.fouls>=k(W).BEFORE_ELIMINATION?(d(),V(i,{key:2,type:"danger",size:"small",onClick:p[2]||(p[2]=v=>S("eliminate",s.player.id))},{default:a(()=>p[6]||(p[6]=[h(" Удалить ")])),_:1,__:[6]})):M("",!0),s.player.fouls>=k(W).BEFORE_ELIMINATION?(d(),V(i,{key:3,type:"info",size:"small",onClick:p[3]||(p[3]=v=>S("reset",s.player.id))},{default:a(()=>p[7]||(p[7]=[h(" Сбросить ")])),_:1,__:[7]})):M("",!0)]),_:1})])):M("",!0)])}}},Ba=j(La,[["__scopeId","data-v-78591a42"]]),xa={class:"player-role"},Ua={key:1,class:"role-display"},Ha={class:"role-text"},za={key:2,class:"role-hidden"},Ka={__name:"PlayerRole",props:{player:{type:Object,required:!0},visible:{type:Boolean,default:!1},editable:{type:Boolean,default:!1}},emits:["changeRole"],setup(s){const e=y=>{switch(y){case b.CIVILIAN:return ve;case b.SHERIFF:return $e;case b.MAFIA:return ie;case b.DON:return ie;default:return ve}},u=y=>{switch(y){case b.CIVILIAN:return"#67c23a";case b.SHERIFF:return"#409eff";case b.MAFIA:return"#f56c6c";case b.DON:return"#e6a23c";default:return"#909399"}},S=y=>{switch(y){case b.CIVILIAN:return"success";case b.SHERIFF:return"primary";case b.MAFIA:return"danger";case b.DON:return"warning";default:return"info"}},o=y=>{switch(y){case b.CIVILIAN:return"М";case b.SHERIFF:return"Ш";case b.MAFIA:return"М";case b.DON:return"Д";default:return"?"}};return(y,C)=>{const w=ee,p=X;return d(),N("div",xa,[s.editable?(d(),V(p,{key:0,type:S(s.player.role),size:"small",circle:"",onClick:C[0]||(C[0]=i=>y.$emit("changeRole",s.player.id))},{default:a(()=>[t(w,null,{default:a(()=>[(d(),V(Se(e(s.player.role))))]),_:1})]),_:1},8,["type"])):s.visible?(d(),N("div",Ua,[t(w,{color:u(s.player.role)},{default:a(()=>[(d(),V(Se(e(s.player.role))))]),_:1},8,["color"]),g("span",Ha,F(o(s.player.role)),1)])):(d(),N("div",za,[t(w,null,{default:a(()=>[t(k(rt))]),_:1})]))])}}},Wa=j(Ka,[["__scopeId","data-v-a1bb4186"]]),ja={class:"player-nomination"},Ya={key:1,class:"nomination-display"},qa={key:2,class:"no-nomination"},Xa={__name:"PlayerNomination",props:{player:{type:Object,required:!0},players:{type:Array,required:!0},gameState:{type:Object,required:!0}},emits:["nominate"],setup(s,{emit:e}){const u=s,S=e,o=R(()=>u.player.isAlive&&!u.player.isEliminated&&u.gameState.gameStatus===T.IN_PROGRESS&&(u.gameState.gameSubstatus===O.DISCUSSION||u.gameState.gameSubstatus===O.CRITICAL_DISCUSSION)),y=R(()=>{if(!o.value)return[];const p=u.gameState.players.filter(i=>i.isAlive&&!i.isEliminated&&i.nominated!==null).map(i=>i.nominated);return u.players.filter(i=>i.id===u.player.id?!0:i.isAlive&&!i.isEliminated&&(!p.includes(i.id)||i.id===u.player.nominated))}),C=p=>{const i=u.players.find(n=>n.id===p);return i?`${i.id}: ${i.name}`:`Игрок ${p}`},w=p=>{S("nominate",u.player.id,p)};return(p,i)=>{const n=Ae,v=we,A=ce;return d(),N("div",ja,[o.value?(d(),V(v,{key:0,"model-value":s.player.nominated,placeholder:"Выберите игрока",size:"small",clearable:"",onChange:w,style:{width:"100%"}},{default:a(()=>[(d(!0),N(K,null,Z(y.value,I=>(d(),V(n,{key:I.id,label:`${I.id}: ${I.name}`,value:I.id},null,8,["label","value"]))),128))]),_:1},8,["model-value"])):s.player.nominated?(d(),N("div",Ya,[t(A,{type:"warning"},{default:a(()=>[h(F(C(s.player.nominated)),1)]),_:1})])):(d(),N("div",qa," — "))])}}},Ja=j(Xa,[["__scopeId","data-v-0317d88b"]]),Za={class:"player-actions"},Qa={__name:"PlayerActions",props:{player:{type:Object,required:!0}},emits:["silentNow","silentNext","eliminate","reset"],setup(s){const e=s,u=async()=>{try{await ae.confirm(`Вы уверены, что хотите удалить игрока ${e.player.name}?`,"Подтверждение",{confirmButtonText:"Да",cancelButtonText:"Отмена",type:"warning"}),$emit("eliminate",e.player.id)}catch{}};return(S,o)=>{const y=X,C=ee,w=de;return d(),N("div",Za,[t(w,{wrap:""},{default:a(()=>[s.player.fouls===k(W).BEFORE_SILENCE&&!s.player.isSilent&&!s.player.silentNextRound?(d(),N(K,{key:0},[t(y,{type:"warning",size:"small",onClick:o[0]||(o[0]=p=>S.$emit("silentNow",s.player.id))},{default:a(()=>o[3]||(o[3]=[h(" Молчит сейчас ")])),_:1,__:[3]}),t(y,{type:"info",size:"small",onClick:o[1]||(o[1]=p=>S.$emit("silentNext",s.player.id))},{default:a(()=>o[4]||(o[4]=[h(" След. круг ")])),_:1,__:[4]})],64)):M("",!0),s.player.fouls>=k(W).BEFORE_ELIMINATION&&!s.player.isEliminated?(d(),N(K,{key:1},[t(y,{type:"danger",size:"small",onClick:u},{default:a(()=>[t(C,null,{default:a(()=>[t(k(ut))]),_:1})]),_:1}),t(y,{type:"info",size:"small",onClick:o[2]||(o[2]=p=>S.$emit("reset",s.player.id))},{default:a(()=>[t(C,null,{default:a(()=>[t(k(ct))]),_:1})]),_:1})],64)):M("",!0)]),_:1})])}}},es=j(Qa,[["__scopeId","data-v-08c36b7f"]]),ts={key:0,class:"ppk-controls"},as={class:"ppk-actions"},ss={__name:"PpkControls",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(s,{emit:e}){const u=s,S=e,o=J(),y=R({get:()=>u.modelValue,set:i=>S("update:modelValue",i)}),C=()=>{y.value=!1},w=async()=>{try{await ae.confirm("Подтвердите победу города в результате ППК","Подтверждение",{confirmButtonText:"Да, город победил",cancelButtonText:"Отмена",type:"success"}),await o.finishGame("city_win"),U.success("Игра завершена! Победа мирного города!"),y.value=!1}catch{}},p=async()=>{try{await ae.confirm("Подтвердите победу мафии в результате ППК","Подтверждение",{confirmButtonText:"Да, мафия победила",cancelButtonText:"Отмена",type:"warning"}),await o.finishGame("mafia_win"),U.success("Игра завершена! Победа команды мафии!"),y.value=!1}catch{}};return(i,n)=>{const v=te,A=ee,I=X,E=de;return y.value?(d(),N("div",ts,[t(v,{title:"ППК (Право последнего слова)",description:"Выберите результат голосования ППК",type:"warning",closable:!1,"show-icon":"",class:"mb-3"}),g("div",as,[t(E,null,{default:a(()=>[t(I,{type:"info",onClick:C},{default:a(()=>[t(A,null,{default:a(()=>[t(k(dt))]),_:1}),n[0]||(n[0]=h(" Отменить "))]),_:1,__:[0]}),t(I,{type:"danger",onClick:p},{default:a(()=>[t(A,null,{default:a(()=>[t(k(ie))]),_:1}),n[1]||(n[1]=h(" Победа мафии "))]),_:1,__:[1]}),t(I,{type:"success",onClick:w},{default:a(()=>[t(A,null,{default:a(()=>[t(k(Ne))]),_:1}),n[2]||(n[2]=h(" Победа города "))]),_:1,__:[2]})]),_:1})])])):M("",!0)}}},ns=j(ss,[["__scopeId","data-v-560d1729"]]),ls={class:"card-header"},os={class:"header-actions"},is={key:0,class:"table-footer"},rs={__name:"PlayersTable",setup(s){const e=J(),u=H(!1),S=H(!1),o=H(!1),y=R(()=>e.gameState.players.filter(m=>!m.isEliminated)),C=R(()=>e.gameState.gameStatus===T.IN_PROGRESS),w=R(()=>e.isGameInProgress&&e.gameState.round>0),p=m=>{const l=e.currentPlayer(m);l&&(l.fouls<W.BEFORE_SILENCE||l.fouls===W.BEFORE_SILENCE&&(l.isSilent||l.silentNextRound)||l.fouls>=W.BEFORE_ELIMINATION)&&e.incrementFoul(m)},i=m=>{const l=e.currentPlayer(m);l&&(l.fouls=0,U.success(`Фолы игрока ${l.name} сброшены`))},n=m=>{const l=e.changePlayerRole(m);if(l){const D=e.currentPlayer(m);U.info(`Роль игрока ${D.name} изменена на ${l}`)}},v=(m,l)=>{e.nominatePlayer(m,l)},A=m=>{const l=e.currentPlayer(m);l&&(l.isSilent=!0,U.warning(`Игрок ${l.name} молчит на этом кругу`))},I=m=>{const l=e.currentPlayer(m);l&&(l.silentNextRound=!0,U.warning(`Игрок ${l.name} будет молчать на следующем кругу`))},E=m=>{ae.confirm("Вы уверены, что хотите удалить этого игрока?","Подтверждение",{confirmButtonText:"Да",cancelButtonText:"Отмена",type:"warning"}).then(()=>{e.eliminatePlayer(m);const l=e.currentPlayer(m);U.success(`Игрок ${l.name} удален из игры`)}).catch(()=>{})};return(m,l)=>{const D=X,G=Oe,B=Pe,P=de,f=se;return d(),V(f,{class:"players-table"},{header:a(()=>[g("div",ls,[l[5]||(l[5]=g("span",null,"Игроки",-1)),g("div",os,[t(D,{type:"info",text:"",onClick:l[0]||(l[0]=_=>k(e).gameState.rolesVisible=!k(e).gameState.rolesVisible)},{default:a(()=>[h(F(k(e).gameState.rolesVisible?"Скрыть роли":"Показать роли"),1)]),_:1})])])]),default:a(()=>[t(B,{data:y.value,stripe:"",style:{width:"100%"}},{default:a(()=>[t(G,{prop:"id",label:"№",width:"60",align:"center"}),t(G,{label:"Фолы",width:"100",align:"center"},{default:a(({row:_})=>[t(Ba,{player:_,onIncrement:p,onReset:i},null,8,["player"])]),_:1}),t(G,{label:"Роль",width:"120",align:"center"},{default:a(({row:_})=>[t(Wa,{player:_,visible:k(e).gameState.rolesVisible||!k(e).gameState.isGameStarted,editable:k(e).isInRoleDistribution,onChangeRole:n},null,8,["player","visible","editable"])]),_:1}),t(G,{prop:"name",label:"Игрок"}),t(G,{label:"Номинация"},{default:a(({row:_})=>[t(Ja,{player:_,players:k(e).alivePlayers,"game-state":k(e).gameState,onNominate:v},null,8,["player","players","game-state"])]),_:1}),C.value?(d(),V(G,{key:0,label:"Действия",width:"200"},{default:a(({row:_})=>[t(es,{player:_,onSilentNow:A,onSilentNext:I,onEliminate:E},null,8,["player"])]),_:1})):M("",!0)]),_:1},8,["data"]),k(e).isGameInProgress?(d(),N("div",is,[t(P,null,{default:a(()=>[t(D,{type:"warning",onClick:l[1]||(l[1]=_=>u.value=!0),disabled:!w.value},{default:a(()=>l[6]||(l[6]=[h(" ППК ")])),_:1,__:[6]},8,["disabled"]),t(D,{type:"danger",onClick:l[2]||(l[2]=_=>S.value=!0)},{default:a(()=>l[7]||(l[7]=[h(" Отменить игру ")])),_:1,__:[7]}),t(D,{type:"info",onClick:l[3]||(l[3]=_=>o.value=!0)},{default:a(()=>l[8]||(l[8]=[h(" Удалить игрока ")])),_:1,__:[8]})]),_:1})])):M("",!0),t(ns,{modelValue:u.value,"onUpdate:modelValue":l[4]||(l[4]=_=>u.value=_)},null,8,["modelValue"])]),_:1})}}},us=j(rs,[["__scopeId","data-v-5955220e"]]),cs={class:"elimination-dialog"},ds={class:"players-grid"},ms=["onClick"],_s={class:"player-number"},fs={class:"player-info"},gs={class:"player-name"},vs={class:"player-role"},Ss={key:0,class:"elimination-reason mt-4"},ys={class:"dialog-footer"},ps={__name:"PlayerEliminationDialog",setup(s,{expose:e}){const u=J(),S=H(!1),o=H(null),y=H("foul_limit"),C=H(""),w=R(()=>u.gameState.players.filter(I=>I.isAlive&&!I.isEliminated)),p=I=>({Мирный:"success",Шериф:"primary",Мафия:"danger",Дон:"warning"})[I]||"info",i=()=>{S.value=!0,o.value=null,y.value="foul_limit",C.value=""},n=()=>{S.value=!1},v=I=>{o.value=I},A=async()=>{if(!o.value)return;const I=u.currentPlayer(o.value);try{await ae.confirm(`Вы уверены, что хотите удалить игрока ${I.name}?`,"Подтверждение удаления",{confirmButtonText:"Да, удалить",cancelButtonText:"Отмена",type:"warning"}),u.eliminatePlayer(o.value),U.success(`Игрок ${I.name} удален из игры`),n()}catch{}};return e({show:i}),(I,E)=>{const m=te,l=ce,D=_t,G=mt,B=Ie,P=X,f=Ee;return d(),V(f,{modelValue:S.value,"onUpdate:modelValue":E[2]||(E[2]=_=>S.value=_),title:"Удаление игрока",width:"600px","before-close":n},{footer:a(()=>[g("div",ys,[t(P,{onClick:n},{default:a(()=>E[8]||(E[8]=[h("Отмена")])),_:1,__:[8]}),t(P,{type:"danger",onClick:A,disabled:!o.value},{default:a(()=>E[9]||(E[9]=[h(" Удалить игрока ")])),_:1,__:[9]},8,["disabled"])])]),default:a(()=>[g("div",cs,[t(m,{title:"Выберите игрока для удаления из игры",type:"warning",closable:!1,"show-icon":"",class:"mb-4"}),g("div",ds,[(d(!0),N(K,null,Z(w.value,_=>(d(),N("div",{key:_.id,class:ke(["player-card",{selected:o.value===_.id}]),onClick:Y=>v(_.id)},[g("div",_s,F(_.id),1),g("div",fs,[g("div",gs,F(_.name),1),g("div",vs,[t(l,{type:p(_.originalRole),size:"small"},{default:a(()=>[h(F(_.originalRole),1)]),_:2},1032,["type"])])])],10,ms))),128))]),o.value?(d(),N("div",Ss,[E[7]||(E[7]=g("h6",null,"Причина удаления:",-1)),t(G,{modelValue:y.value,"onUpdate:modelValue":E[0]||(E[0]=_=>y.value=_)},{default:a(()=>[t(D,{value:"foul_limit"},{default:a(()=>E[3]||(E[3]=[h("Превышение лимита фолов")])),_:1,__:[3]}),t(D,{value:"misbehavior"},{default:a(()=>E[4]||(E[4]=[h("Нарушение правил")])),_:1,__:[4]}),t(D,{value:"technical"},{default:a(()=>E[5]||(E[5]=[h("Технические причины")])),_:1,__:[5]}),t(D,{value:"other"},{default:a(()=>E[6]||(E[6]=[h("Другое")])),_:1,__:[6]})]),_:1},8,["modelValue"]),y.value==="other"?(d(),V(B,{key:0,modelValue:C.value,"onUpdate:modelValue":E[1]||(E[1]=_=>C.value=_),placeholder:"Укажите причину",class:"mt-2"},null,8,["modelValue"])):M("",!0)])):M("",!0)])]),_:1},8,["modelValue"])}}},hs=j(ps,[["__scopeId","data-v-c5b90b76"]]),Is={class:"cancellation-dialog"},Es={key:0,class:"restart-info"},bs={class:"dialog-footer"},Rs={__name:"GameCancellationDialog",setup(s,{expose:e}){const u=J(),S=H(!1),o=ye({reason:"",playerSlot:null,comment:"",withRestart:!1}),y=()=>{S.value=!0,Object.assign(o,{reason:"",playerSlot:null,comment:"",withRestart:!1})},C=()=>{S.value=!1},w=i=>({player_misbehavior:"Нарушение правил игроком",technical_issues:"Технические проблемы",insufficient_players:"Недостаточно игроков",other:"Другая причина"})[i]||i,p=async()=>{if(!o.reason){U.error("Выберите причину отмены");return}const i=`
    Подтвердите отмену игры:
    
    Причина: ${w(o.reason)}
    ${o.playerSlot?`Игрок: ${o.playerSlot}`:""}
    ${o.comment?`Комментарий: ${o.comment}`:""}
    Перерасдача: ${o.withRestart?"Да":"Нет"}
  `;try{await ae.confirm(i,"Подтверждение отмены игры",{confirmButtonText:"Да, отменить",cancelButtonText:"Отмена",type:"warning"}),await u.cancelGame(o.reason,o.playerSlot,o.comment,o.withRestart)?(U.success("Игра отменена"),C()):U.error("Ошибка при отмене игры")}catch{}};return e({show:y}),(i,n)=>{const v=te,A=Ae,I=we,E=gt,m=Ie,l=vt,D=ft,G=X,B=Ee;return d(),V(B,{modelValue:S.value,"onUpdate:modelValue":n[4]||(n[4]=P=>S.value=P),title:"Отмена игры",width:"500px","before-close":C},{footer:a(()=>[g("div",bs,[t(G,{onClick:C},{default:a(()=>n[7]||(n[7]=[h("Отмена")])),_:1,__:[7]}),t(G,{type:"danger",onClick:p,disabled:!o.reason},{default:a(()=>n[8]||(n[8]=[h(" Отменить игру ")])),_:1,__:[8]},8,["disabled"])])]),default:a(()=>[g("div",Is,[t(v,{title:"Внимание!",description:"Отмена игры приведет к завершению текущего процесса. Это действие нельзя отменить.",type:"warning",closable:!1,"show-icon":"",class:"mb-4"}),t(D,{model:o,"label-width":"120px"},{default:a(()=>[t(E,{label:"Причина отмены",required:""},{default:a(()=>[t(I,{modelValue:o.reason,"onUpdate:modelValue":n[0]||(n[0]=P=>o.reason=P),placeholder:"Выберите причину",style:{width:"100%"}},{default:a(()=>[t(A,{label:"Нарушение правил игроком",value:"player_misbehavior"}),t(A,{label:"Технические проблемы",value:"technical_issues"}),t(A,{label:"Недостаточно игроков",value:"insufficient_players"}),t(A,{label:"Другая причина",value:"other"})]),_:1},8,["modelValue"])]),_:1}),o.reason==="player_misbehavior"?(d(),V(E,{key:0,label:"Номер игрока"},{default:a(()=>[t(I,{modelValue:o.playerSlot,"onUpdate:modelValue":n[1]||(n[1]=P=>o.playerSlot=P),placeholder:"Выберите игрока",style:{width:"100%"},clearable:""},{default:a(()=>[(d(!0),N(K,null,Z(k(u).gameState.players,P=>(d(),V(A,{key:P.id,label:`${P.id}: ${P.name}`,value:P.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):M("",!0),t(E,{label:"Комментарий"},{default:a(()=>[t(m,{modelValue:o.comment,"onUpdate:modelValue":n[2]||(n[2]=P=>o.comment=P),type:"textarea",rows:3,placeholder:"Дополнительная информация (необязательно)"},null,8,["modelValue"])]),_:1}),t(E,null,{default:a(()=>[t(l,{modelValue:o.withRestart,"onUpdate:modelValue":n[3]||(n[3]=P=>o.withRestart=P)},{default:a(()=>n[5]||(n[5]=[h(" Перерасдача (начать заново с рассадки) ")])),_:1,__:[5]},8,["modelValue"]),n[6]||(n[6]=g("div",{class:"form-text"}," При включении этой опции после отмены можно будет начать новую игру ",-1))]),_:1,__:[6]})]),_:1},8,["model"]),o.withRestart?(d(),N("div",Es,[t(v,{title:"Перерасдача",description:"После отмены игры будет доступна кнопка для начала новой игры с теми же игроками",type:"info",closable:!1,"show-icon":""})])):M("",!0)])]),_:1},8,["modelValue"])}}},Ns=j(Rs,[["__scopeId","data-v-81993d3d"]]),Cs={class:"score-manager"},Ts={class:"base-score"},$s={class:"score-summary mt-4"},ks={class:"ranking-list"},As={class:"rank-position"},ws={class:"player-info"},Ps={class:"player-name"},Os={class:"player-role"},Vs={class:"player-score"},Ms={class:"dialog-footer"},Ds={__name:"ScoreManagerDialog",setup(s,{expose:e}){const u=J(),S=H(!1),o=H(!1),y=ye({}),C=ye({}),w=R(()=>u.gameState.players.map(f=>({...f,baseScore:v(f.id),additionalScore:y[f.id]||0}))),p=R(()=>[...u.gameState.players].sort((f,_)=>A(_.id)-A(f.id))),i=()=>{S.value=!0,u.gameState.players.forEach(f=>{const _=u.getPlayerScore(f.id);y[f.id]=_.additionalScore||0,C[f.id]=""})},n=()=>{S.value=!1},v=f=>u.getPlayerScore(f).baseScore||0,A=f=>{const _=v(f),Y=y[f]||0;return _+Y},I=f=>({Мирный:"success",Шериф:"primary",Мафия:"danger",Дон:"warning"})[f]||"info",E=f=>f.isAlive?f.isEliminated?"warning":"success":"danger",m=f=>f.isAlive?f.isEliminated?"Исключен":"Выжил":"Убит",l=f=>f>=2?"success":f>=1?"primary":f>=0?"warning":"danger",D=f=>f===1?"success":f===2?"primary":f===3?"warning":"info",G=f=>{const _=v(f),Y=y[f]||0;u.setPlayerScore(f,_,Y)},B=()=>{u.gameState.players.forEach(f=>{y[f.id]=0,G(f.id)}),U.info("Дополнительные баллы сброшены")},P=async()=>{o.value=!0;try{u.gameState.players.forEach(f=>{G(f.id)}),u.setGameStatus(T.FINISHED_WITH_SCORES),await u.saveGameState(),U.success("Баллы успешно сохранены!"),n()}catch(f){console.error("Ошибка сохранения баллов:",f),U.error("Ошибка при сохранении баллов")}finally{o.value=!1}};return e({show:i}),(f,_)=>{const Y=te,x=Oe,q=ce,re=St,me=Ie,_e=Pe,fe=se,ne=X,ge=Ee;return d(),V(ge,{modelValue:S.value,"onUpdate:modelValue":_[0]||(_[0]=L=>S.value=L),title:"Выставление баллов игрокам",width:"90%","before-close":n,"destroy-on-close":""},{footer:a(()=>[g("div",Ms,[t(ne,{onClick:n},{default:a(()=>_[2]||(_[2]=[h("Отмена")])),_:1,__:[2]}),t(ne,{onClick:B},{default:a(()=>_[3]||(_[3]=[h("Сбросить доп. баллы")])),_:1,__:[3]}),t(ne,{type:"success",onClick:P,loading:o.value},{default:a(()=>_[4]||(_[4]=[h(" Сохранить баллы ")])),_:1,__:[4]},8,["loading"])])]),default:a(()=>[g("div",Cs,[t(Y,{title:"Выставление дополнительных баллов",description:"Базовые баллы уже установлены в зависимости от результата игры. Здесь вы можете добавить дополнительные баллы от -3 до +3",type:"info",closable:!1,class:"mb-4"}),t(_e,{data:w.value,stripe:"",style:{width:"100%"},class:"scores-table"},{default:a(()=>[t(x,{prop:"id",label:"№",width:"60",align:"center"}),t(x,{prop:"name",label:"Игрок",width:"150"}),t(x,{prop:"originalRole",label:"Роль",width:"100",align:"center"},{default:a(({row:L})=>[t(q,{type:I(L.originalRole),size:"small"},{default:a(()=>[h(F(L.originalRole),1)]),_:2},1032,["type"])]),_:1}),t(x,{prop:"status",label:"Статус",width:"120",align:"center"},{default:a(({row:L})=>[t(q,{type:E(L),size:"small"},{default:a(()=>[h(F(m(L)),1)]),_:2},1032,["type"])]),_:1}),t(x,{prop:"baseScore",label:"Базовый балл",width:"120",align:"center"},{default:a(({row:L})=>[g("span",Ts,F(v(L.id)),1)]),_:1}),t(x,{label:"Доп. баллы",width:"180",align:"center"},{default:a(({row:L})=>[t(re,{modelValue:y[L.id],"onUpdate:modelValue":Q=>y[L.id]=Q,min:-3,max:3,step:.1,precision:1,size:"small","controls-position":"right",style:{width:"120px"},onChange:Q=>G(L.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(x,{label:"Итого",width:"100",align:"center"},{default:a(({row:L})=>[t(q,{type:l(A(L.id)),size:"large"},{default:a(()=>[g("strong",null,F(A(L.id).toFixed(1)),1)]),_:2},1032,["type"])]),_:1}),t(x,{label:"Комментарий"},{default:a(({row:L})=>[t(me,{modelValue:C[L.id],"onUpdate:modelValue":Q=>C[L.id]=Q,placeholder:"Комментарий к баллам (необязательно)",size:"small",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"]),g("div",$s,[t(fe,null,{header:a(()=>_[1]||(_[1]=[g("h6",null,"Итоговый рейтинг",-1)])),default:a(()=>[g("div",ks,[(d(!0),N(K,null,Z(p.value,(L,Q)=>(d(),N("div",{key:L.id,class:"ranking-item"},[g("div",As,[t(q,{type:D(Q+1),size:"large"},{default:a(()=>[h(F(Q+1),1)]),_:2},1032,["type"])]),g("div",ws,[g("span",Ps,F(L.name),1),g("span",Os,"("+F(L.originalRole)+")",1)]),g("div",Vs,[g("strong",null,F(A(L.id).toFixed(1)),1)])]))),128))])]),_:1})])])]),_:1},8,["modelValue"])}}},Fs=j(Ds,[["__scopeId","data-v-ee5010f1"]]),Gs={class:"game-view"},Ls={class:"game-header"},Bs={class:"round-info"},xs={class:"timer-section"},Us={class:"game-actions"},Hs={__name:"GameView",props:{eventId:Number,tableId:Number,gameId:Number},setup(s){const e=s;Et();const u=J(),S=R(()=>u.gameState.gameStatus===T.IN_PROGRESS&&u.gameState.gameSubstatus===O.VOTING),o=R(()=>u.gameState.gameStatus===T.IN_PROGRESS&&u.gameState.gameSubstatus===O.NIGHT),y=R(()=>u.gameState.gameStatus===T.IN_PROGRESS&&u.gameState.showBestMove);let C=null;return yt(async()=>{try{await u.initGame(e.eventId,e.tableId,e.gameId),C=setInterval(()=>{u.saveGameState()},3e4)}catch(w){console.error("Ошибка инициализации игры:",w),U.error("Не удалось загрузить игру")}}),be(()=>{C&&clearInterval(C),u.saveGameState()}),(w,p)=>{const i=pt,n=ht,v=It;return d(),N("div",Gs,[t(v,null,{default:a(()=>[t(i,null,{default:a(()=>[g("div",Ls,[g("div",Bs,[g("h2",null,"Круг: "+F(k(u).gameState.round),1)]),g("div",xs,[t(At)]),g("div",Us,[t(Ot)])])]),_:1}),t(n,null,{default:a(()=>[t(xt),S.value?(d(),V(sa,{key:0})):M("",!0),o.value?(d(),V(ba,{key:1})):M("",!0),y.value?(d(),V(Ma,{key:2})):M("",!0),t(us)]),_:1})]),_:1}),t(hs),t(Ns),t(Fs)])}}},js=j(Hs,[["__scopeId","data-v-403e399d"]]);export{js as default};
