import{r as C,a as ne,D as oe,c as k,b as d,w as s,d as t,m as ie,E as ue,e as de,i as Z,j as r,J as re,l as E,_ as ce,o as _e,n as _,W as me,s as n,x as g,$ as pe,t as u,X as ve,P as fe,Q as ge,B as ye,u as be,v as he,a0 as ke,L as h,p as we,F as Q,q as W,M as U,V as X,a1 as Ee,a2 as Ce,Z as Ve,a3 as Ie,K as Te,z as $e,a4 as De,y as Ge,O as Be}from"./index-DopsCuGS.js";import{u as Se,_ as xe}from"./CreateTableDialog-fUK7uFNu.js";import{a as q}from"./el-radio-DW38t20Y.js";const Le={__name:"CreateGameDialog",props:{modelValue:Boolean,eventId:Number,tableId:Number},emits:["update:modelValue","game-created"],setup(H,{emit:V}){const I=H,i=V,o=C(),f=C(!1),v=ne({name:""}),x={name:[{required:!0,message:"Введите название игры",trigger:"blur"}]},T=oe({get:()=>I.modelValue,set:p=>i("update:modelValue",p)}),$=()=>{var p;T.value=!1,(p=o.value)==null||p.resetFields()},L=async()=>{if(o.value)try{await o.value.validate(),f.value=!0;const p={...v,eventId:I.eventId},c=await q.createGame(p);i("game-created",c),$()}catch(p){console.error("Ошибка создания игры:",p),E.error("Ошибка при создании игры")}finally{f.value=!1}};return(p,c)=>{const R=de,z=ue,N=ie,G=Z,j=re;return d(),k(j,{modelValue:T.value,"onUpdate:modelValue":c[1]||(c[1]=D=>T.value=D),title:"Новая игра",width:"400px","before-close":$},{footer:s(()=>[t(G,{onClick:$},{default:s(()=>c[2]||(c[2]=[r("Отмена")])),_:1,__:[2]}),t(G,{type:"primary",onClick:L,loading:f.value},{default:s(()=>c[3]||(c[3]=[r(" Создать игру ")])),_:1,__:[3]},8,["loading"])]),default:s(()=>[t(N,{model:v,rules:x,ref_key:"formRef",ref:o,"label-width":"120px"},{default:s(()=>[t(z,{label:"Название",prop:"name"},{default:s(()=>[t(R,{modelValue:v.name,"onUpdate:modelValue":c[0]||(c[0]=D=>v.name=D),placeholder:"Например: Игра #1"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},Re={class:"event-view"},ze={class:"event-header"},Ne={class:"card-header"},je={key:0,class:"event-info"},Me={class:"info-item"},Fe={class:"info-item"},Ue={class:"info-item"},qe={class:"info-item"},He={class:"info-item"},Je={class:"card-header"},Ke={key:0},Oe={key:0,class:"no-tables"},Pe={class:"tables-list"},Qe=["onClick"],We={class:"table-content"},Xe={class:"table-name"},Ze={class:"table-meta"},Ae={key:0,class:"judge-info"},Ye={class:"card-header"},et={key:0,class:"no-selection"},tt={key:1,class:"table-details"},st={class:"table-info mb-4"},at={class:"games-section"},lt={key:0,class:"no-games"},nt={key:1,class:"games-grid"},ot={class:"game-header"},it={class:"game-name"},ut={class:"game-actions"},dt={class:"game-info"},rt={class:"game-meta"},ct={class:"game-date"},_t={key:0,class:"game-progress"},mt={key:1,class:"game-result"},pt={class:"game-footer"},vt={__name:"EventView",setup(H){const V=Ie(),I=Te();Se();const i=C(null),o=C(null),f=C(!1),v=C(!1),x=a=>{o.value=a},T=a=>{const e=parseInt(V.params.id),m=o.value.id;I.push(`/game?eventId=${e}&tableId=${m}&gameId=${a}`)},$=async a=>{try{await Be.confirm("Вы уверены, что хотите удалить эту игру?","Подтверждение",{confirmButtonText:"Да",cancelButtonText:"Отмена",type:"warning"});const e=parseInt(V.params.id),m=o.value.id;await q.deleteGame(a),o.value&&o.value.games&&(o.value.games=o.value.games.filter(M=>M.id!==a)),E.success("Игра удалена!")}catch(e){e!=="cancel"&&E.error("Ошибка при удалении игры")}},L=()=>{c(),f.value=!1,E.success("Стол создан!")},p=()=>{c(),v.value=!1,E.success("Игра создана!")},c=async()=>{try{const a=parseInt(V.params.id);i.value=await q.getEvent(a),i.value.tables.length>0&&(o.value=i.value.tables[0])}catch{E.error("Ошибка загрузки мероприятия"),I.push("/")}},R=a=>({planned:"В планах",active:"Активно",completed:"Завершено"})[a]||"Неизвестно",z=a=>a&&{planned:"info",active:"success",completed:"info"}[a]||"info",N=a=>({funky:"Фанки",minicap:"Миникап",tournament:"Турнир",charity_tournament:"Благотворительный"})[a]||"Фанки",G=a=>({ru:"Русский",en:"English",am:"Հայերեն"})[a]||"Русский",j=a=>{const e=Math.abs(a)%100;if(e>=5&&e<=20)return"столов";const m=e%10;return m===1?"стол":m>=2&&m<=4?"стола":"столов"},D=a=>({not_started:"Не начата",in_progress:"В процессе",finished:"Завершена"})[a]||"Неизвестно",A=a=>a&&{not_started:"info",in_progress:"primary",finished:"success"}[a]||"info",Y=a=>({city_win:"Победа города",mafia_win:"Победа мафии",draw:"Ничья"})[a]||a,ee=a=>a&&{city_win:"success",mafia_win:"danger",draw:"warning"}[a]||"info",J=a=>new Date(a).toLocaleDateString("ru-RU",{day:"2-digit",month:"long",year:"numeric"});return _e(()=>{c()}),(a,e)=>{var P;const m=Z,M=me,y=he,b=be,K=$e,B=ye,F=we,O=ge,S=Ce,te=Ee,se=fe,ae=ve,le=Ve;return d(),_("div",Re,[t(le,null,{default:s(()=>[t(M,null,{default:s(()=>{var l;return[n("div",ze,[t(m,{onClick:e[0]||(e[0]=w=>a.$router.push("/")),icon:g(pe)},{default:s(()=>e[5]||(e[5]=[r(" Назад к мероприятиям ")])),_:1,__:[5]},8,["icon"]),n("h1",null,u(((l=i.value)==null?void 0:l.name)||"Загрузка мероприятия..."),1)])]}),_:1}),t(ae,null,{default:s(()=>[t(se,{gutter:20},{default:s(()=>[t(O,{md:8},{default:s(()=>[t(B,{class:"mb-4"},{header:s(()=>[n("div",Ne,[t(y,null,{default:s(()=>[t(g(ke))]),_:1}),e[6]||(e[6]=n("span",null,"Информация о мероприятии",-1))])]),default:s(()=>[i.value?(d(),_("div",je,[n("div",Me,[t(b,{type:z(i.value.status),class:"mb-2"},{default:s(()=>[r(u(R(i.value.status)),1)]),_:1},8,["type"]),t(b,{type:"info",class:"ml-2"},{default:s(()=>[r(u(N(i.value.category)),1)]),_:1})]),n("div",Fe,[e[7]||(e[7]=n("h6",null,"Описание:",-1)),n("p",null,u(i.value.description||"Описание отсутствует"),1)]),n("div",Ue,[e[8]||(e[8]=n("h6",null,"Дата проведения:",-1)),n("p",null,u(J(i.value.date)),1)]),n("div",qe,[e[9]||(e[9]=n("h6",null,"Язык:",-1)),n("p",null,u(G(i.value.language)),1)]),n("div",He,[e[10]||(e[10]=n("h6",null,"Столы:",-1)),n("p",null,u(i.value.tables.length)+" "+u(j(i.value.tables.length)),1)])])):(d(),k(K,{key:1,rows:5,animated:""}))]),_:1}),t(B,null,{header:s(()=>[n("div",Je,[t(y,null,{default:s(()=>[t(g(U))]),_:1}),e[12]||(e[12]=n("span",null,"Игровые столы",-1)),i.value&&i.value.status!=="completed"?(d(),k(m,{key:0,type:"primary",size:"small",onClick:e[1]||(e[1]=l=>f.value=!0)},{default:s(()=>[t(y,null,{default:s(()=>[t(g(X))]),_:1}),e[11]||(e[11]=r(" Добавить "))]),_:1,__:[11]})):h("",!0)])]),default:s(()=>[i.value?(d(),_("div",Ke,[i.value.tables.length===0?(d(),_("div",Oe,[t(F,{description:"У этого мероприятия еще нет столов"})])):h("",!0),n("div",Pe,[(d(!0),_(Q,null,W(i.value.tables,l=>{var w;return d(),_("div",{key:l.id,class:De(["table-item",{active:((w=o.value)==null?void 0:w.id)===l.id}]),onClick:ft=>x(l)},[n("div",We,[n("div",Xe,u(l.name),1),n("div",Ze,[t(b,{type:l.seatingType==="free"?"success":"primary",size:"small"},{default:s(()=>[r(u(l.seatingType==="free"?"Свободная рассадка":"Заданная рассадка"),1)]),_:2},1032,["type"]),l.judge?(d(),_("span",Ae," Судья: "+u(l.judge),1)):h("",!0)])])],10,Qe)}),128))])])):(d(),k(K,{key:1,rows:3,animated:""}))]),_:1})]),_:1}),t(O,{md:16},{default:s(()=>[t(B,null,{header:s(()=>{var l;return[n("div",Ye,[t(y,null,{default:s(()=>[t(g(U))]),_:1}),n("span",null,u(o.value?o.value.name:"Выберите стол"),1),o.value&&((l=i.value)==null?void 0:l.status)!=="completed"?(d(),k(m,{key:0,type:"success",size:"small",onClick:e[2]||(e[2]=w=>v.value=!0)},{default:s(()=>[t(y,null,{default:s(()=>[t(g(X))]),_:1}),e[13]||(e[13]=r(" Новая игра "))]),_:1,__:[13]})):h("",!0)])]}),default:s(()=>[o.value?(d(),_("div",tt,[n("div",st,[t(te,{column:2,border:""},{default:s(()=>[t(S,{label:"Название"},{default:s(()=>[r(u(o.value.name),1)]),_:1}),t(S,{label:"Тип рассадки"},{default:s(()=>[t(b,{type:o.value.seatingType==="free"?"success":"primary"},{default:s(()=>[r(u(o.value.seatingType==="free"?"Свободная":"Заданная"),1)]),_:1},8,["type"])]),_:1}),o.value.judge?(d(),k(S,{key:0,label:"Судья"},{default:s(()=>[r(u(o.value.judge),1)]),_:1})):h("",!0),t(S,{label:"Количество игр"},{default:s(()=>{var l;return[r(u(((l=o.value.games)==null?void 0:l.length)||0),1)]}),_:1})]),_:1})]),n("div",at,[e[15]||(e[15]=n("h5",{class:"section-title"},"Игры",-1)),!o.value.games||o.value.games.length===0?(d(),_("div",lt,[t(F,{description:"У этого стола еще нет игр"})])):(d(),_("div",nt,[(d(!0),_(Q,null,W(o.value.games,l=>(d(),k(B,{key:l.id,class:"game-card",shadow:"hover"},{default:s(()=>[n("div",ot,[n("h6",it,u(l.name),1),n("div",ut,[t(m,{type:"danger",size:"small",circle:"",onClick:w=>$(l.id)},{default:s(()=>[t(y,null,{default:s(()=>[t(g(Ge))]),_:1})]),_:2},1032,["onClick"])])]),n("div",dt,[n("div",rt,[n("span",ct,u(J(l.created)),1),t(b,{type:A(l.status)},{default:s(()=>[r(u(D(l.status)),1)]),_:2},1032,["type"])]),l.status==="in_progress"?(d(),_("div",_t,[t(b,{type:"info"},{default:s(()=>[r("Круг: "+u(l.currentRound),1)]),_:2},1024)])):h("",!0),l.status==="finished"&&l.result?(d(),_("div",mt,[t(b,{type:ee(l.result)},{default:s(()=>[r(u(Y(l.result)),1)]),_:2},1032,["type"])])):h("",!0)]),n("div",pt,[t(m,{type:"primary",onClick:w=>T(l.id),style:{width:"100%"}},{default:s(()=>e[14]||(e[14]=[r(" Войти в игру ")])),_:2,__:[14]},1032,["onClick"])])]),_:2},1024))),128))]))])])):(d(),_("div",et,[t(F,{description:"Выберите стол из списка слева"},{image:s(()=>[t(y,{size:"100",color:"#c0c4cc"},{default:s(()=>[t(g(U))]),_:1})]),_:1})]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(xe,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=l=>f.value=l),"event-id":parseInt(a.$route.params.id),onTableCreated:L},null,8,["modelValue","event-id"]),t(Le,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=l=>v.value=l),"event-id":parseInt(a.$route.params.id),"table-id":(P=o.value)==null?void 0:P.id,onGameCreated:p},null,8,["modelValue","event-id","table-id"])])}}},ht=ce(vt,[["__scopeId","data-v-9748952c"]]);export{ht as default};
